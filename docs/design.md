# デッキ構築型ローグライクゲーム設計書

## 要件定義書

### ゲーム概要
- プレイヤーはカードを使用して敵を倒し、ステージを進むデッキ構築型ローグライクゲーム。
- 各ステージで新しいカードを獲得し、デッキを強化する。
- 敵を倒すごとに報酬を獲得し、戦略的にデッキを構築する。

### 必須要件
1. **カードシステム**
   - 攻撃カード、スキルカード、パワーカードの3種類を実装。
   - 各カードにはコスト、効果、説明が含まれる。
   - **攻撃カード**: 敵にダメージを与えるカード。バフ/デバフ効果を付与可能。
   - **スキルカード**: 防御や特殊な効果（例: 回復、状態異常解除）を持つカード。バフ/デバフ効果を付与可能。
   - **パワーカード**: 戦闘中に永続的な効果を発揮するカード。
2. **戦闘システム**
   - ターン制バトルを実装。
   - プレイヤーと敵が交互に行動する。
3. **デッキ構築**
   - ステージクリア時に新しいカードを選択してデッキに追加。
   - デッキの最大枚数を設定。
4. **ランダム性**
   - ステージ構成や敵の種類、カードの選択肢はランダムに生成。
5. **UI/UX**
   - カードのドラッグ＆ドロップ操作をサポート。
   - 戦闘中のHPやエネルギーの表示。
6. **アーティファクトシステム**
   - 以下のような効果をもったアーティファクトシステムを実装。
     - 例1：ターン開始時に追加で1枚のカードをドローする
     - 例2：戦闘中初めてプレイする攻撃カードは追加で10のダメージを得る
7. **レアリティシステム**
   - カードやアーティファクトに3段階のレアリティを付与して高レアリティのものほど出現率を下げる。

### 追加要件
- プレイヤーの進行状況を保存する機能。
- カードのアップグレードシステム。
- 敵のAIロジック。

---

## 設計書

### 概略
- React + TypeScript を使用してフロントエンドを構築。
- 状態管理には Jotai を使用。
- スタイルは SCSS を採用し、BEM命名規則を使用。
- テストフレームワークとして Vitest を使用。

### クラス構成

#### **Card**
- **プロパティ**
  - `id`: カードの一意な識別子。
  - `name`: カード名。
  - `type`: カードの種類（攻撃、スキル、パワー）。
  - `cost`: カードのコスト。
  - `effect`: カードの効果（関数として実装）。
  - `description`: カードの説明文。
  - `additionalEffects`: 攻撃やスキルに付随するバフ/デバフ効果（`Effect[]` 型）。
- **メソッド**
  - `applyEffect(target: Player | Enemy)`: カードの効果を適用する。

#### **Player**
- **プロパティ**
  - `hp`: 現在のHP。
  - `energy`: 現在のエネルギー。
  - `deck`: デッキ（カードの配列）。
  - `hand`: 手札（カードの配列）。
  - `effects`: 現在のバフ・デバフのリスト（`Effect[]` 型）。
- **メソッド**
  - `drawCard()`: デッキからカードを引く。
  - `playCard(card: Card, target: Player | Enemy)`: カードを使用する。
  - `applyEffect(effect: Effect)`: バフ・デバフを適用する。
  - `removeExpiredEffects()`: 効果の持続ターンが終了したものを削除する。

#### **Enemy**
- **プロパティ**
  - `hp`: 現在のHP。
  - `behavior`: 敵の行動パターン。
  - `effects`: 現在のバフ・デバフのリスト（`Effect[]` 型）。
- **メソッド**
  - `takeTurn()`: 敵のターンを実行する。
  - `applyEffect(effect: Effect)`: バフ・デバフを適用する。
  - `removeExpiredEffects()`: 効果の持続ターンが終了したものを削除する。

#### **Effect**
- **プロパティ**
  - `id`: 一意な識別子。
  - `name`: 効果名（例: 攻撃力アップ、防御力ダウン）。
  - `duration`: 効果の持続ターン数。
  - `apply`: 効果を適用する関数（`(target: Player | Enemy) => void`）。
  - `remove`: 効果を解除する関数（`(target: Player | Enemy) => void`）。
- **メソッド**
  - `decrementDuration()`: 持続ターン数を減少させる。

#### **Artifact**
- **プロパティ**
  - `id`: アーティファクトの一意な識別子。
  - `name`: アーティファクト名。
  - `description`: アーティファクトの説明文。
  - `rarity`: アーティファクトのレアリティ（例: Common, Rare, Legendary）。
  - `effect`: アーティファクトの効果（関数として実装）。
- **メソッド**
  - `applyEffect(player: Player)`: アーティファクトの効果をプレイヤーに適用する。
  - `removeEffect(player: Player)`: アーティファクトの効果をプレイヤーから解除する。

---